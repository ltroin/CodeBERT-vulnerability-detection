# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

import json
import random
import math
# The code first generates 80% of the indices for the train data, 10% for the test data, and 10% for the valid data randomly.
# This code takes the indices of the train, test, and valid data and writes them to their respective .txt files.
# The train, test, and valid indices are then added to their respective sets to be used later in the code.

js_all=[json.loads(line) for line in open('../modified_merged_devign.json')]
indices = list(range(len(js_all)))
print(indices)
# for random shuffling the indices
random.shuffle(indices)
train_size = math.ceil(len(js_all)*0.8)
test_size = math.floor(len(js_all)*0.1)
val_size = test_size
train_indices = indices[0:train_size]
test_indices = indices[train_size:train_size+test_size]
valid_indices = indices[train_size+test_size:train_size+test_size+val_size]

train_index=set()
valid_index=set()
test_index=set()


# write the indices to the txt files
with open("train.txt", "w") as file:
    for index in train_indices:
        file.write(str(index))
        file.write("\n")
        train_index.add(int(index))

with open("test.txt", "w") as file:
    for index in test_indices:
        file.write(str(index))
        file.write("\n")
        test_index.add(int(index))

with open("valid.txt", "w") as file:
    for index in valid_indices:
        file.write(str(index))
        file.write("\n")
        valid_index.add(int(index))

# write the json files according to the indices  
with open('train.jsonl','w') as f:
    for idx,js in enumerate(js_all):
        if idx in train_index:
            js['idx']=idx
            f.write(json.dumps(js)+'\n')
            
with open('valid.jsonl','w') as f:
    for idx,js in enumerate(js_all):
        if idx in valid_index:
            js['idx']=idx
            f.write(json.dumps(js)+'\n')
            
with open('test.jsonl','w') as f:
    for idx,js in enumerate(js_all):
        if idx in test_index:
            js['idx']=idx
            f.write(json.dumps(js)+'\n')
